# 用户提示优化说明

本文档说明了根据《03-使用指南.md》对系统用户提示信息的优化改进。

## 优化内容概览

### 1. 投稿创建确认消息 ✅

**位置**: `services/submission_service.py` - `create_submission()` 方法

**改进前**: 用户发送投稿后没有立即确认反馈

**改进后**: 
```
🎉 收到你的投稿！
⏰ 投稿编号: #1234

我们的 AI 正在审核中，请耐心等待...
```

**说明**: 用户发送投稿后立即收到确认，让用户知道系统已收到投稿并开始处理。

---

### 2. 审核通过通知 ✅

**位置**: `services/notification_service.py` - `send_submission_approved()` 方法

**改进前**: 
```
您的投稿已通过审核！
编号：#1234
```

**改进后**:
```
✅ 你的投稿已通过审核！
📝 投稿编号: #1234
⏰ 预计在 18:00 发布到各平台
```

**说明**: 
- 添加了友好的 emoji 图标
- 自动计算并显示预计发布时间（根据各平台的 `send_schedule` 配置）
- 如果没有定时配置，显示"将尽快发布到各平台"

---

### 3. 审核拒绝通知 ✅

**位置**: `services/notification_service.py` - `send_submission_rejected()` 方法

**改进前**:
```
您的投稿未通过审核。
原因：[原因]
```

**改进后**:
```
❌ 很抱歉，你的投稿未通过审核
📝 投稿编号: #1234
💬 原因: [管理员填写的原因]
```

**说明**: 添加了 emoji 图标和更清晰的格式，使信息更易读。

---

### 4. 用户反馈提示优化 ✅

#### 4.1 反馈指令提示

**位置**: `receivers/qq/nonebot_receiver.py` - `_try_handle_private_command()` 方法

**改进**:
- **成功**: `✅ 感谢反馈，我们已记录！您的反馈对我们很重要，我们会认真处理。`
- **失败**: `❌ 反馈保存失败，请稍后重试`

#### 4.2 举报指令提示

**改进**:
- **功能未开启**: `❌ 举报失败\n\n举报功能未开启`
- **投稿不存在**: `❌ 举报失败\n\n投稿 #1234 不存在或已被删除`
- **系统错误**: `❌ 系统错误\n\n投稿信息获取失败，请稍后重试`
- **已收到举报**: 
  ```
  ✅ 举报已收到
  
  📝 投稿编号: #1234
  🔍 我们的 AI 正在审核您的举报，请耐心等待...
  ```
- **人工审核中**:
  ```
  ⚠️ 举报处理中
  
  📝 投稿编号: #1234
  🔍 您的举报已进入人工审核阶段，我们会尽快处理
  
  处理完成后将通过私聊通知您
  ```
- **处理失败**: `❌ 举报处理失败\n\n请稍后重试，或使用 #反馈 指令联系我们`

#### 4.3 删除指令提示

**改进**:
- **未找到投稿**: `❌ 删除失败\n\n未找到编号 #1234 对应的投稿`
- **投稿不存在**: `❌ 删除失败\n\n投稿不存在`
- **权限不足**: `❌ 删除失败\n\n只能删除自己的投稿`
- **服务不可用**: `❌ 服务暂不可用\n\n请稍后再试`
- **删除成功**: `✅ 删除成功\n\n投稿 #1234 已删除`
- **删除失败**: `❌ 删除失败\n\n请稍后再试，或使用 #反馈 指令联系我们`

#### 4.4 评论指令提示

**改进**:
- **未找到投稿**: `❌ 评论失败\n\n未找到编号 #1234 对应的投稿`
- **内容为空**: `❌ 评论失败\n\n评论内容不能为空`
- **投稿不存在**: `❌ 评论失败\n\n投稿不存在`
- **投稿未发布**: `❌ 评论失败\n\n投稿尚未发布，无法同步评论到平台`
- **功能未启用**: `❌ 评论失败\n\n本组未启用 #评论 功能`
- **评论成功**: `✅ 评论成功\n\n您的评论已同步到投稿 #1234 的所有发布平台`
- **评论失败**: `❌ 评论失败\n\n[错误详情]\n\n请稍后重试，或使用 #反馈 指令联系我们`
- **系统异常**: `❌ 评论失败\n\n系统异常，请稍后重试`

---

## 优化原则

所有优化都遵循以下原则：

1. **友好性**: 使用友好的语气和 emoji 图标，让用户感受到温暖
2. **清晰性**: 信息结构清晰，使用换行和分段，易于阅读
3. **完整性**: 提供足够的信息，包括编号、状态、原因等
4. **引导性**: 在失败时提供明确的下一步建议（如使用 #反馈 指令）
5. **一致性**: 所有提示使用统一的格式和风格

---

## 技术实现

### 编号显示优化

所有面向用户的编号显示都优先使用 `publish_id`（发布编号），如果不存在则使用内部 `id`：

```python
display_id = submission.publish_id if submission.publish_id else submission.id
message += f"📝 投稿编号: #{display_id}"
```

### 定时发布时间计算

审核通过通知会自动计算最早的发布时间：

```python
# 遍历所有平台配置
for platform_name in ['qzone', 'bilibili', 'rednote']:
    platform_cfg = get_platform_config(platform_name)
    if platform_cfg and platform_cfg.get('enabled'):
        schedules = platform_cfg.get('send_schedule', [])
        # 找到最早的未来时间点
        ...
```

---

## 测试建议

建议测试以下场景：

1. **投稿流程**:
   - 发送新投稿 → 应收到确认消息
   - 审核通过 → 应收到带预计发布时间的通知
   - 审核拒绝 → 应收到带原因的通知

2. **用户指令**:
   - `#反馈 测试反馈` → 应收到感谢消息
   - `#举报 1234 测试举报` → 应收到举报确认
   - `#删除 1234` → 应收到删除结果
   - `#评论 1234 测试评论` → 应收到评论结果

3. **错误处理**:
   - 使用不存在的编号 → 应收到友好的错误提示
   - 权限不足的操作 → 应收到权限提示
   - 功能未开启 → 应收到功能未开启提示

---

## 相关文件

- `services/submission_service.py` - 投稿服务，处理投稿创建和确认
- `services/notification_service.py` - 通知服务，处理审核通知
- `receivers/qq/nonebot_receiver.py` - QQ 接收器，处理用户指令和反馈

---

最后更新: 2025-10-10

